<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efexzium Chat UI</title>
</head>
<body>
    <div id="chatContainer">
        <div id="header">
            <button id="hamburgerMenu">â˜°</button>
            <span>=$=</span>
        </div>
        <div id="sidebar" style="display: none;">
            <a href="index.html">Home</a>
            <a href="plans.html">Plans</a>
            <a href="settings.html">Settings</a>
            <a href="help.html">Help</a>
        </div>
        <div id="messageList"></div>
        <div id="inputArea">
            <button id="uploadBtn">Upload</button>
            <textarea id="userInput" placeholder="Type your message here..."></textarea>
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const sidebar = document.getElementById('sidebar');
        const sendButton = document.getElementById('sendBtn');
        const messageList = document.getElementById('messageList');
        const userInput = document.getElementById('userInput');

        hamburgerMenu.addEventListener('click', function() {
            sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
        });

        document.addEventListener('click', function(e) {
            if (!hamburgerMenu.contains(e.target) && !sidebar.contains(e.target)) {
                sidebar.style.display = 'none';
            }
        });

        function getMonthlyGoal() {
            return localStorage.getItem('monthlyGoal') || '';
        }

        sendButton.addEventListener('click', sendMessage);

        async function sendMessage() {
            const userMessage = userInput.value.trim();
            if (!userMessage) return;

            // Add user message to UI
            addMessageToUI('user', userMessage);
            userInput.value = '';

            // Get the monthly goal
            const monthlyGoal = getMonthlyGoal();

            // Call API
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer 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",
                        "HTTP-Referer": "http://localhost", // Replace with your actual site URL
                        "X-Title": "Efexzium Chat", // Replace with your actual site name
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "meta-llama/llama-3.1-8b-instruct:free",
                        "messages": [
                            {"role": "system", "content": `The user's monthly goal is: ${monthlyGoal}`},
                            {"role": "user", "content": userMessage},
                        ],
                    })
                });

                const data = await response.json();
                const aiMessage = data.choices[0].message.content;

                // Add AI message to UI
                addMessageToUI('assistant', aiMessage);
            } catch (error) {
                console.error('Error:', error);
                addMessageToUI('assistant', 'Sorry, I encountered an error while processing your request.');
            }
        }

        function addMessageToUI(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = `${role}: ${content}`;
            messageList.appendChild(messageDiv);
            messageList.scrollTop = messageList.scrollHeight;
        }
    </script>
</body>
</html>